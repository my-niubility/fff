<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html" charset="utf-8" />
<title>订单详情</title>
<link rel="stylesheet" href="css/common.css" type="text/css"/>
<link rel="stylesheet" href="css/page.css" type="text/css"/>
</head>
<body>
	<script type="text/javascript" src="js/header.js" ></script>
    <!--内容区域start-->
    <div class="bodybg">
    	<div class="w1000 clearfix">
	    	<!--面包屑-->
	    	<div class="crumb"><a href="index.html">首页 </a> > <a href="#">会员中心 </a> > <a href="#">交易管理</a> > <a class="col1">订单详情</a></div>
			<!--侧导航BEGIN-->
	        <div class="nav_left fl">
	            <div class="nav_box clearfix">
	               <div class="nav_list"><a href="javascript:;"><i class="nav_icon1"></i>资产管理</a>
	                   <ul class="nav_ul1 clearfix none">
	                   		<li><a href="myAsset.html">我的资产</a></li>
	                       	<!--<li><a href="">我的红包</a></li>
	                       	<li><a href="">我的奖券</a></li>-->
	                   </ul>
	               </div>
	               <div class="nav_list"><a href="javascript:;"><i class="nav_icon2"></i>交易管理</a>
	                    <ul class="nav_ul1 clearfix ">
	                       <li><a href="#" class="active">交易记录</a></li>
	                       <li><a href="rechargeRecord.html">充值记录</a></li>
	                       <li><a href="cashRecord.html">提现记录</a></li>
	                       <li><a href="capitalFlow.html">资金流水</a></li>
	                    </ul>
	               </div>
	               <div class="nav_list"><a href="javascript:;"><i class="nav_icon3"></i>安全管理</a>
	                    <ul class="nav_ul1 clearfix none">
	                       <li><a href="identityManagement.html">认证管理</a></li>
	                       <li><a href="pasManagement.html">密码管理</a></li>
	                       <li><a href="cardManagement.html">银行卡管理</a></li>
	                    </ul>
	               </div>
	               <div class="nav_list"><a href="javascript:;"><i class="nav_icon4"></i>信息管理</a>
	                    <ul class="nav_ul1 clearfix none">
	                       <li><a href="baseInfo.html">基本信息</a></li>
	                       <li><a href="messageCenter.html">消息中心</a></li>
	                    </ul>
	               </div>
	           </div>   
	        </div>
	        <!--侧导航END-->
	        <!--右侧信息start-->
	        <div class="bgcol baseInfo_rg fl">
        		<div class="baseInfo_borb">
        			<div class="baseInfo_title">订单详情</div>
        		</div>
        		<div class="clearfix payOrder_form">
	    			<p>订单信息</p>
                    <table class="asset_wrap" border="0" cellpadding="0" cellspacing="0">
                        <thead class="asset_wrap_tit">
                            <tr>
                                <td width="70">产品名称</td>
                                <td>订单号</td>
                                <td>订单时间</td>
                                <td>订单金额(元)</td>
                                <!--<td>商品原价(元)</td>-->
                                <td>购买数量</td>
                                <!--<td>可转让数量</td>-->
                                <td>持有天数(天)</td>
                                <td>状态</td>
                                <td>返租模式</td>
                                <td>操作</td>
                            </tr>
                        </thead>
                        <tbody class="asset_wrap_con" id="orderInfo">
                            <tr>
                                <td>美橙53号</td>
                                <td>112016041411157949</td>
                                <td>2016-04-14 16:20:36</td>
                                <td>2000.00</td>
                                <td>2000.00</td>
                                <td>1</td>
                                <td>1</td>
                                <td>0</td>
                                <td>已取消</td>
                                <td>固定收益</td>
                                <td>订单状态不为已支付</td>
                            </tr>
                        </tbody>
                    </table>
                    <!--<p>项目信息</p>
                    <div class="projectInfo clearfix">
                    	<div class="projectInfo_left fl">
	                    	<p>项目名称：美橙53号</p>
	                    	<p>项目地址：江西新余</p>
	                    	<p>项目概述：江西新余 高新区屋顶光伏发电站 投产运营</p>
	                    	<p>项目进度： 已建好</p>
	                    	<p>计租模式： 固定收益</p>
	                    	<p>锁定期（天）：360</p>
                    	</div>
                    	<div class="projectInfo_right fl">
                    		<p>项目名称：美橙53号</p>
                    		<img src="img/cheng.gif" />
                		</div>
                    </div>-->
	    			<p>支付信息</p>
	                <table class="asset_wrap" border="0" cellpadding="0" cellspacing="0">
	                    <thead class="asset_wrap_tit">
	                        <tr>
	                            <td>支付方式</td>
	                            <td>应付金额(元)</td>
	                            <td>红包总额(元)</td>
	                            <td>红包总额(元)</td>
	                        </tr>
	                    </thead>
	                    <tbody class="asset_wrap_con" id="payInfo">
	                        <!--<tr>
	                            <td>快捷支付</td>
	                            <td>2000</td>
	                            <td>0</td>
	                            <td>2000</td>
	                        </tr>-->
	                    </tbody>
	                </table>
	                <!--<p>反租信息</p>
	                <table class="total_form" border="0" cellpadding="0" cellspacing="0">
                        <thead><tr><td colspan="3">累计返租（元）</td></tr></thead>
                        <tr>
                            <th>返租时间</th>
                            <th>返租金额（元）</th>
                            <th>备注</th>
                        </tr>
                        <tr>
                            <td colspan="3" align="center">暂无记录</td>
                        </tr>
	                </table>-->
                </div>
        	</div>
	        <!--右侧信息end-->
        </div>
    </div>
    <!--内容区域end-->
   <script type="text/javascript" src="js/footer.js" ></script>
</body>
<script type="text/javascript" src="js/jquery-1.4.4.min.js"></script><!--jQuery 库-->
<script type="text/javascript" src="js/tools.js" ></script>
<script type="text/javascript" src="js/common.js" ></script>
<script>
	var tradeOrderId = location.href.substr(location.href.indexOf("=")+1);
	var tradeTotalAmt;
	$(function(){
		var orderInfo = {};
		Utils.ajax({
			url:"/restful/tradeorder/querydetail",
			type:"post",
			data:{"custId":custId,"tradeOrderId":tradeOrderId},
			success:function(data,xml){
				if(data.meta.success){
					if(data.data){
						if(data.data.to){
							var orderData = data.data.to;
							var strHtml = '';
							var state,handle;
							switch (orderData.orderStatus){
								case "00":
									state = "等待支付";
									handle = "<a href='javascript:;' data-orderId='"+orderData.id+"'>去支付</a>";
									break;
								case "01":
									state = "支付成功";
									handle = "--";
									break;
								case "02":
									state = "支付失败";
									handle = "--";
									break;
								case "03":
									state = "支付作废";
									handle = "--";
									break;
							}
							tradeTotalAmt = orderData.tradeTalAmt;
							orderData.createTime = orderData.createTime.split(" ")[0];
//							orderData.id = orderData.id.replace(orderData.id.substr(3,orderData.id.length-6),"***");
							strHtml += '<tr><td class="over-ellips" style="width:12%;">'+orderData.productNane+'</td><td>'+orderData.id+'</td>'+
                                '<td>'+orderData.createTime+'</td><td>'+tradeTotalAmt+'</td>'+//<td>'+orderData.tradeTalAmt+'</td>
                                '<td>'+orderData.purchasePortion+'</td>';//<td>0</td>
                            Utils.ajax({
								url:"/restful/product/query/prddetail",
								type:"post",
								data:{"productId":orderData.productId},
								success:function(request,xml){
									if(request.meta.success){
										if(request.data){
											if(request.data.prdComm){
												request =  request.data.prdComm;
												var repayMode;
												switch (request.repayMode){
													case "0":
														repayMode = "等额本息还款";
														break;
													case "1":
														repayMode = "一次还本付息";
														break;
													case "2":
														repayMode = "等额本金";
														break;
													case "3":
														repayMode = "每月还息到期还本";
														break;
												}
					                            strHtml +='<td>'+request.holdPeriod+'</td><td>'+state+'</td>'+
					                                '<td>'+repayMode+'</td><td>'+handle+'</td></tr>';
												$("#orderInfo").html(strHtml);
											}
										}
									}else{
										//会话过期，返回登录页面
										if(request.meta.message.indexOf("请您先登录")>-1){
											location.href = "timeOut.html";
											return;
										}
										alert(request.meta.message);
									}
								}
                            });
						}
						if(data.data.pos && data.data.pos.length>0){
							var payData = data.data.pos;
							var payWay;
							var payHtml = '';
							for(var i=0;i<payData.length;i++){
								switch(payData[i].paymentType){
									case "00":
										payWay = "账户支付";
										break;
									case "01":
										payWay = "网关支付";
										break;
									case "02":
										payWay = "快捷支付";
										break;
									case "03":
										payWay = "银行账户转账";
										break;
									case "04":
										payWay = "银行收账";
										break;
								}
								payHtml += '<tr><td>'+payWay+'</td><td>'+tradeTotalAmt+'</td><td>'+0+'</td><td>'+0+'</td></tr>'
							}
							$("#payInfo").html(payHtml);
						}else{
							$("#payInfo").html("<tr><td colspan='4'>暂无信息</td></tr>")
						}
					}
				}else{
					//会话过期，返回登录页面
					if(data.meta.message.indexOf("请您先登录")>-1){
						location.href = "timeOut.html";
						return;
					}
					alert(data.meta.message);
				}
			}
		});
		//点击去支付
		$("#orderInfo tr td a").live("click",function(e){
			var tradeOrderId = $(e.target).data("orderId");//订单号
			Utils.ajax({
				url:"/restful/token/get",
				type:"post",
				data:{"custId":custId,"busCase":"01","tradeOrderId":tradeOrderId},
				success:function(data,xml){
					if(data.meta.success){
						if(data.data){
							orderInfo.token = data.data;//口令
                            orderInfo.orderId = tradeOrderId;//订单号
							localStorage.setItem("orderInfo",JSON.stringify(orderInfo));
							setTimeout(function(){
								location.href = "payOrder.html";
							},1000);
						}
					}else{
						//会话过期，返回登录页面
						if(data.meta.message.indexOf("请您先登录")>-1){
							location.href = "timeOut.html";
							return;
						}
						alert(data.meta.message);
					}
				}
			})
		})
	});
	
	
</script>
</html>
